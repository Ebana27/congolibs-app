<!-- Reader fragment (from src/pages/reader.html body) -->
<header class="sticky top-0 z-10 bg-white shadow-sm">
  <div class="flex items-center justify-between px-4 py-3">
    <button onclick="history.back()" class="text-2xl">←</button>
    <h1 id="book-title" class="text-lg font-bold">Chargement...</h1>
    <button onclick="toggleFullscreen()" class="text-2xl">⛶</button>
  </div>
</header>

<!-- Canvas PDF -->
<div id="pdf-container" class="flex flex-col items-center p-4 pb-32">
  <canvas id="pdf-canvas"></canvas>
</div>

<!-- Contrôles -->
<div class="pdf-controls">
  <button onclick="previousPage()" class="px-3 py-1 text-xl">←</button>
  <span id="page-info" class="text-sm font-semibold">1 / 1</span>
  <button onclick="nextPage()" class="px-3 py-1 text-xl">→</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
  const pdfjsLib = window['pdfjs-dist/build/pdf'];
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
  let pdfDoc = null;
  let pageNum = 1;
  let pageRendering = false;
  let pageNumPending = null;
  const scale = 1.5;
  const canvas = document.getElementById('pdf-canvas');
  const ctx = canvas.getContext('2d');
  const urlParams = new URLSearchParams(window.location.hash.replace(/^#/, '').split('?')[1] || window.location.search);
  const pdfFile = urlParams.get('file') || 'sample.pdf';
  pdfjsLib.getDocument(`/pdfs/${pdfFile}`).promise.then(pdf => {
    pdfDoc = pdf;
    document.getElementById('page-info').textContent = `1 / ${pdf.numPages}`;
    renderPage(pageNum);
  });
  function renderPage(num) {
    pageRendering = true;
    pdfDoc.getPage(num).then(page => {
      const viewport = page.getViewport({ scale: scale });
      canvas.height = viewport.height;
      canvas.width = viewport.width;
      const renderContext = { canvasContext: ctx, viewport: viewport };
      const renderTask = page.render(renderContext);
      renderTask.promise.then(() => {
        pageRendering = false;
        if (pageNumPending !== null) { renderPage(pageNumPending); pageNumPending = null; }
      });
    });
    document.getElementById('page-info').textContent = `${num} / ${pdfDoc.numPages}`;
  }
  function queueRenderPage(num) { if (pageRendering) { pageNumPending = num; } else { renderPage(num); } }
  function previousPage() { if (pageNum <= 1) return; pageNum--; queueRenderPage(pageNum); }
  function nextPage() { if (pageNum >= pdfDoc.numPages) return; pageNum++; queueRenderPage(pageNum); }
  function toggleFullscreen() { if (!document.fullscreenElement) { document.documentElement.requestFullscreen(); } else { document.exitFullscreen(); } }
  document.addEventListener('keydown', (e) => { if (e.key === 'ArrowLeft') previousPage(); if (e.key === 'ArrowRight') nextPage(); });
</script>
